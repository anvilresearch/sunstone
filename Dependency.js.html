<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Dependency.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Dependency.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

/**
 * Dependencies
 * @ignore
 */
const Model = require('../data/Model')

/**
 * Constants
 * @ignore
 */
const ARROW_ARG = /^([^\(]+?)=>/
const FN_ARGS = /^[^\(]*\(\s*([^\)]*)\)/m
const FN_ARG_SPLIT = /,/
const FN_ARG = /^\s*(_?)(\S+?)\1\s*$/
const STRIP_COMMENTS = /((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg

/**
 * Dependency
 *
 * @class
 * Instances of Dependency are self-validating containers for
 * dependencies registered on the injector.
 *
 * @param {Object} descriptor - Dependency descriptor
 *
 * @extends Model
 */
class Dependency extends Model {

  /**
   * Extract Dependencies
   * Adapted from AngularJS.
   * @private
   */
  static extractDependencies (fn) {
    let str = fn.toString().replace(STRIP_COMMENTS, '')
    let match = str.match(ARROW_ARG) || str.match(FN_ARGS)
    let args = match[1].split(FN_ARG_SPLIT)
    let result = args.map(str => str.trim())
    return result[0] !== '' ? result : []
  }

  /**
   * extractDependencies
   *
   * @description
   * Parse dependencies and store them as an array of dependency
   * names on this instance.
   *
   */
  extractDependencies () {
    if (this.fn &amp;&amp; !this.dependencies) {
      this.dependencies = Dependency.extractDependencies(this.fn)
    }
  }

  /**
   * get schema
   * @private
   */
  static get schema () {

    /**
     * conform
     *
     * validation function for factory function and value on schema
     */
    function conform (value, instance) {
      // if there is a value present then dependency is valid
      if (instance.value) {
        return true
      }

      // check if there is a function present on the dependency
      return instance.fn
        ? typeof instance.fn === 'function'
        : false
    }

    // a standardised conformer property for factory function (fn)
    // and value on schema
    let conformer = {
      type: 'any',
      conform,
      messages: {
        conform: 'function or value is required'
      }
    }

    /**
     * Dependency schema
     */
    return {
      name: { type: 'string', required: true },
      type: { type: 'string', required: true },
      plugin: { type: 'string', required: true },
      fn: conformer,
      value: conformer,
      dependencies: { type: 'array' }
    }
  }

}

/**
 * Exports
 */
module.exports = Dependency
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Collection.html">Collection</a></li><li><a href="Dependency.html">Dependency</a></li><li><a href="DependencyCollection.html">DependencyCollection</a></li><li><a href="Host.html">Host</a></li><li><a href="Injector.html">Injector</a></li><li><a href="Plugin.html">Plugin</a></li><li><a href="PluginCollection.html">PluginCollection</a></li><li><a href="Registry.html">Registry</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Tue Feb 09 2016 11:07:55 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
